-- Clients table
CREATE TABLE clients (
    client_id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    given_name VARCHAR(50) NOT NULL,
    surname VARCHAR(50) NOT NULL,
    social_security VARCHAR(11) UNIQUE,
    birth_date DATE,
    email_address VARCHAR(100) UNIQUE,
    contact_number VARCHAR(20),
    marital_state VARCHAR(20),
    nationality VARCHAR(50)
);

-- Mortgage_requests table
CREATE TABLE mortgage_requests (
    request_id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    client_id INT,
    request_date DATE NOT NULL,
    requested_amount DECIMAL(12, 2) NOT NULL,
    mortgage_type VARCHAR(50) NOT NULL,
    request_status VARCHAR(20) NOT NULL,
    FOREIGN KEY (client_id) REFERENCES clients(client_id)
);

-- Real_estate table
CREATE TABLE real_estate (
    estate_id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    request_id INT UNIQUE,
    street_address VARCHAR(255) NOT NULL,
    city_name VARCHAR(100) NOT NULL,
    state_name VARCHAR(50) NOT NULL,
    postal_code VARCHAR(10) NOT NULL,
    valuation_amount DECIMAL(12, 2),
    sale_price DECIMAL(12, 2),
    FOREIGN KEY (request_id) REFERENCES mortgage_requests(request_id)
);

-- Mortgages table
CREATE TABLE mortgages (
    mortgage_id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    request_id INT UNIQUE,
    initial_amount DECIMAL(12, 2) NOT NULL,
    annual_rate DECIMAL(5, 4) NOT NULL,
    duration_months INT NOT NULL,
    commencement_date DATE NOT NULL,
    maturity_date DATE NOT NULL,
    monthly_installment DECIMAL(10, 2) NOT NULL,
    outstanding_balance DECIMAL(12, 2) NOT NULL,
    FOREIGN KEY (request_id) REFERENCES mortgage_requests(request_id)
);

-- Repayment_schedule table
CREATE TABLE repayment_schedule (
    repayment_id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    mortgage_id INT,
    installment_number INT NOT NULL,
    due_date DATE NOT NULL,
    installment_amount DECIMAL(10, 2) NOT NULL,
    principal_component DECIMAL(10, 2) NOT NULL,
    interest_component DECIMAL(10, 2) NOT NULL,
    remaining_balance DECIMAL(12, 2) NOT NULL,
    FOREIGN KEY (mortgage_id) REFERENCES mortgages(mortgage_id)
);

-- Transactions table
CREATE TABLE transactions (
    transaction_id INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) PRIMARY KEY,
    mortgage_id INT,
    transaction_date DATE NOT NULL,
    transaction_amount DECIMAL(10, 2) NOT NULL,
    principal_paid DECIMAL(10, 2) NOT NULL,
    interest_paid DECIMAL(10, 2) NOT NULL,
    penalty_fees DECIMAL(8, 2) DEFAULT 0,
    estate_id INT,
    FOREIGN KEY (mortgage_id) REFERENCES mortgages(mortgage_id),
    FOREIGN KEY (estate_id) REFERENCES real_estate(estate_id)
);